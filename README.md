# Проектная работа "Веб-ларек"

Ссылка на проект: https://github.com/z-hit/web-larek-frontend

Проект магазина товаров для Веб-разработчиков. В магазине можно выбирать товары из Каталога, добавлять их в Коризну, переходить в Коризну и оформлять покупку путем ввода контактных данных и выбора способа оплаты. При желании можно удалить товары из Коризны, или добавить новые к уже имеющимся.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Проект реализовать на основе принципов MVС (Model, View, Controller).

В части Model представлен абстрактный класс Model и реализующий его AppState, отвещающий за хранение ключевых данных o всех товарах и о заказе, необходимые для взаимодействия с сервером и осуществеления бизнес логики.

В части View представлен абстрактный класс Component, который реализуется в нескольких классах ++++++++++

В части Controller представлен класс EventEmitter, который отслеживает изменения состояния приложения и оповещает о них необходимые компоненты приложения, которые также меняются в ответ на произошедшие изменения.

## URL схема с архитектурой проекта

Ссылка на UML схему с Архитектурой проекта:
https://github.com/z-hit/web-larek-frontend/blob/0fd4a15151fa457292c99c6b88a8fd888ee3920a/UML%20Web%20Larek.jpg

## Базовый код

## API и Котроллер Событий

2. Класс Api реализует взаимодействие с Сервером и имеет следующие поля:
   readonly baseUrl: string - поле с базовым адресом сервера;
   protected options: RequestInit - поле опций вызова запроса.

   Конструктор constructor(baseUrl: string, options: RequestInit = {}) - принимает в качестве аргументов и устанавливает в свои поля базовый адрес сервера и описание для формирования запроса.

   Метод get(uri: string) - принимает адрес сервера и возвращает изначальный список товаров.
   Метод post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает адрес сервера, обект с данными(order) и метод взаимодействия с сервером(POST), метод возволяет фоормить заказ путем отправки на Сервер данных о заказе.
   Метод handleResponse(response: Response): Promise<object> - проверяет статус ответа и возвращает Promise с объектом данных: при успешном ответе возвращает полученные с срвера данные, преобразуя их в формат json; при ошибке работе с сервером, возвращает сообщение об ошибке.

1. Класс EventEmitter позволяет компонентам подписываться на события, уведомлять других  
   подписчиков о произошедших событиях и инициировать изменения. Класс имеет поле:
   \_events: Map<EventName, Set<Subscriber>> - объект со списком событий и обработчиками, который создается конструктором класса.

   Класс включает в себя методы:
   on<T extends object>(eventName: EventName, callback: (event: T) => void) - принимает событие и функцию обработчик, устанавливает обработчик для этого события;
   off(eventName: EventName, callback: Subscriber) - принимает событие и обработчик, в результате снимает обработчки с этого события, при отсутствии обработчкиво удаляет событие полностью;
   emit<T extends object>(eventName: string, data?: T) - принимает событие и данные, инициирует событие с принятыми данными;
   onAll(callback: (event: EmitterEvent) => void) - принимает обработчки событий как аргумент, устанавливает его для всех компонентов для слушания всех событий;
   offAll() - сбрасывает все обработчкик;
   trigger<T extends object>(eventName: string, context?: Partial<T>) - принимает событие и данные, слушает коллбэк триггер, который генерирует событие при своем вызове.

## Компоненты модели данных

1. В части Модели данных представлен абстрактный класс Model. Он принимает в конструктор constructor(data: Partial<T>, protected events: IEvents) определенный тип данных и список событий, которые добавляет в создаваемый объект.
   Имеет метод emitChanges(event: string), который принимает название события и оповещает подписчиков об изменнеиях модели.

2. Класс AppState реализует класс Model и сожержит в себе данные проекта, а именно поля:
   catalog: IItem[] - изначальный каталог товаров, полученный с сервера;
   basket: ItemID[] - список id товаров, добавленных в корзину;
   order: IOrder - полные данные о заказе типа IOrder;
   loading: boolean - статус процесса загрузки данных;
   formErrors: FormErrors = {} - список ошибок, возникших при работе с сервером;
   preview: string | null - статус попапа.

Мутоды AppState:
setCatalog(items: IItem[]): void - получает список изначальных карточек от сервера и сохраняет их в каталог в виде реализации интерфейса IItem;
toggleBasketItem(id: ItemID, isAdded: boolean): void - получает id товара и статус его добавленности в корзину, позволяет добавлять или удалять товар из корзины, в зависимости от статуса;
clearBasket(): void - очищает корзину от всех товаров;
getBasketList(): ItemID[] - возвращает полный список id товаров, добавленных в корзину;
setOrderField(field: keyof IOrder, value: string): void - принимает название поля и текст, затем устанавливает текст в соответствующее поле информации о заказе в формате интерфейса IOrder;
validateOrder(): boolean - возвращает boolean в зависимости от того, прошли ли поля ввода валидацию;
getTotal(): number - возвращает полную стоимость товаров, добавленных в корзину.

## Компоненты представления

## Основные типы данных

```
type ItemID = string;
type Payment = "Онлайн" | "При получении";
type Category = "другое" | "софт-скилл" | "дополнительное" | "кнопка" | "хард-скилл";
type Picture = {
url: string;
title?: string;
alt: string;
}
type Button = {
title?: string;
event: Event;
callback: Function;
disabled?: Boolean;
};
type InputPayment = {
buttonPayOnline: Button;
buttonPayOffline: Button;
}
```
