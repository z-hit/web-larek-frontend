# Проектная работа "Веб-ларек"

Ссылка на проект: https://github.com/z-hit/web-larek-frontend

Проект магазина товаров для Веб-разработчиков. В магазине можно выбирать товары из Каталога, добавлять их в Коризну, переходить в Коризну и оформлять покупку путем ввода контактных данных и выбора способа оплаты. При желании можно удалить товары из Коризны, или добавить новые к уже имеющимся.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Проект реализовать на основе принципов MVС (Model, View, Controller).

В части Model представлен абстрактный класс Model и реализующий его AppState, отвещающий за хранение ключевых данных o товарах и пользователе, необходимые для взаимодействия с сервером и осуществеления бизнес логики.

В части View представлен абстрактный класс Component, который реализуется в нескольких классах ++++++++++

В части Controller представлен класс EventEmitter, который отслеживает изменения состояния приложения и оповещает о них необходимые компоненты приложения, которые также меняются в ответ на произошедшие изменения.

## URL схема с архитектурой проекта

Ссылка на UML схему с Архитектурой проекта:
https://github.com/z-hit/web-larek-frontend/blob/0fd4a15151fa457292c99c6b88a8fd888ee3920a/UML%20Web%20Larek.jpg

## Базовый код

## API и Котроллер Событий

2. Класс Api реализует взаимодействие с Сервером и имеет следующие поля:
   readonly baseUrl: string - поле с базовым адресом сервера;
   protected options: RequestInit - поле опций вызова запроса.

   Конструктор constructor(baseUrl: string, options: RequestInit = {}) - принимает в качестве аргументов и устанавливает в свои поля базовый адрес сервера и описание для формирования запроса.

   Метод get(uri: string) - принимает адрес сервера и возвращает изначальный список товаров.
   Метод post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает адрес сервера, обект с данными пользователя и метод взаимодействия с сервером(POST), метод возволяет фоормить заказ путем отправки на Сервер данных о пользователе и купленных товарах.
   Метод handleResponse(response: Response): Promise<object> - проверяет статус ответа и возвращает

1. Класс EventEmitter позволяет компонентам подписываться на события и уведомлять других  
   подписчиков о произошедших событиях.
   Класс включает в себя методы on, off, emit — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события.
   Дополнительные методы onAll и offAll дают возможность подписки на все события и сброса всех
   подписчиков.
   Метод trigger позволяет генерировать события с заданными аргументами, что позволяет использовать передавать его в качетстве обработчика событий в другие классы и снизить связанность с EventEmitter.

## Компоненты модели данных

1. В части Модели данных представлен абстрактный класс Model. Он принимает в конструктор constructor(data: Partial<T>, protected events: IEvents) определенный тип данных и список событий, которые добавляет в создаваемый объект.
   Имеет метод emitChanges(event: string), который принимает название события и оповещает подписчиков об изменнеиях модели.

2. Класс AppState реализует класс Model и сожержит в себе данные проекта, а именно поля:
   catalog: IItem[] - изначальный каталог товаров, полученный с сервера;
   basket: ItemID[] - список id товаров, добавленных в корзину;
   user: IUser - данные о пользователе типа IUser;
   loading: boolean - статус процесса загрузки данных;
   formErrors: FormErrors = {} - список ошибок, возникших при моединении с сервером;
   modal: string | null - статус попапа.

Мутоды AppState:
setCatalog(items: IItem[]): void - получает список изначальных карточек от сервера и сохраняет их в каталог в виде реализации интерфейса IItem;
toggleBasketItem(id: ItemID, isAdded: boolean): void - получает id товара и статус его добавленности в корзину, позволяет добавлять или удалять товар из корзины, в зависимости от статуса;
clearBasket(): void - очищает корзину от всех товаров;
getBasketItems(): ItemID[] - возвращает полный список id товаров, добавленных в корзину;
setUserField(field: keyof IUser, value: string): void - принимает название поля и текст, затем устанавливает текст в соответствующее поле информации о пользователе в формате интерфейса IUser;
validateOrder(): boolean - возвращает boolean в зависимости от того, прошли ли поля ввода валидацию;
getTotal(): number - возвращает полную стоимость товаров, добавленных в корзину.

## Компоненты представления

1. Класс Main создает главную страницу сайта, которая включает в себя следующие части:
   logo: Picture - ссылка на картинку логотипа,
   catalog: Item[] - список товаров,
   buttonBasket: Button - кнопка открытия Корзины.

   С помощью метода getItems(): Item[] происходит получение списка товаров с Сервера и сохранение в поле catalog.

   При клике по Item (метод openPreview(): void) открывается PopupPreview с данными о конкретном товаре и возможностью добавления товара в Корзину.
   При клике на buttonBasket (метод openBasket(): void) открывается Корзина.

2. Класс Popup создает базовый каркас для всех попапов, которые имеют кнопку закрытия - buttonClose: Button, а также кнопку действия (индивидуального для каждого попапа) - button: Button. Все остальные попапы расширяют класс Popup своими индивидульными данными.

3. Класс PopupBasket расширяет классы Popup и Basket, добавляя заголовок, отображает список карточек товаров, добавленных в Корзину. Он также несет информацию о сумме стоимости всех товаров в корзине.
   При нажатии на кнопку происходит:

- список ID товаров в Корзине отправляется в Обект с данными пользователя - класс User;
- пользователь переводится в попап PopupOrder.

4. Класс IPopupFormInput<T> является дженериком, который имеет стандартную струтуру для всех полей ввода в форме:
   title: string;
   input: T;
   В зависимости от подставляемых данных, input меняется в разных формах.

5. Класс PopupOrder расширяет Popup и включает в себя два IPopupFormInput<T> - первый IPopupFormInput<InputPayment> для создания поля выбора способа оплаты и IPopupFormInput<string> для ввода адреса доставки.
   При нажатии на кнопку происходит:

- сохранение введенных данных в обект с данными о пользователе - класс User;
- очистка полей ввода.

6. Класс PopupContacts расширяет Popup и включает в себя два IPopupFormInput<T> - первый IPopupFormInput<string> для ввода адреса почты и IPopupFormInput<string> для ввода номера телефона.
   При нажатии на кнопку происходит:

   - сохранение введенных данных в обект с данными о пользователе - класс User;
   - отправка полных данные о пользователе на Сервер;
     далее при успешной отпавке данных на сервер:
   - очистка полей ввода;
   - очистка списка товаров в Коризне;
   - перевод пользователя в PopupSucess.

7. Класс PopupSuccess расширяет Popup, добавляя картинку, текст об успешном заказе, а также отображает общую сумму заказа.
   При нажатии на кнопку пользователь перенаправляется на главную страницу для продолжения покупок.

## Основные типы данных

```
type ItemID = string;
type Payment = "Онлайн" | "При получении";
type Category = "другое" | "софт-скилл" | "дополнительное" | "кнопка" | "хард-скилл";
type Picture = {
url: string;
title?: string;
alt: string;
}
type Button = {
title?: string;
event: Event;
callback: Function;
disabled?: Boolean;
};
type InputPayment = {
buttonPayOnline: Button;
buttonPayOffline: Button;
}
```
