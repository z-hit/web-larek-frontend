# Проектная работа "Веб-ларек"

Ссылка на проект: https://github.com/z-hit/web-larek-frontend

Проект магазина товаров для Веб-разработчиков. В магазине можно выбирать товары из Каталога, добавлять их в Коризну, переходить в Коризну и оформлять покупку путем ввода контактных данных и выбора способа оплаты. При желании можно удалить товары из Коризны, или добавить новые к уже имеющимся.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Проект реализовать на основе принципов MVС (Model, View, Controller).

В части Model представлен абстрактный класс Model и реализующий его AppState, отвещающий за хранение ключевых данных o всех товарах и о заказе, необходимые для взаимодействия с сервером и осуществеления бизнес логики.

В части View представлен абстрактный класс Component, который реализуется в нескольких классах ++++++++++

В части Controller представлен класс EventEmitter, который отслеживает изменения состояния приложения и оповещает о них необходимые компоненты приложения, которые также меняются в ответ на произошедшие изменения.

## URL схема с архитектурой проекта

Ссылка на UML схему с Архитектурой проекта:
https://github.com/z-hit/web-larek-frontend/blob/0fd4a15151fa457292c99c6b88a8fd888ee3920a/UML%20Web%20Larek.jpg

## Базовый код

## API и Котроллер Событий (Controller)

2. Класс Api реализует взаимодействие с Сервером и имеет следующие поля:
   readonly baseUrl: string - поле с базовым адресом сервера;
   protected options: RequestInit - поле опций вызова запроса.

   Конструктор constructor(baseUrl: string, options: RequestInit = {}) - принимает в качестве аргументов и устанавливает в свои поля базовый адрес сервера и описание для формирования запроса.

   Метод get(uri: string) - принимает адрес сервера и возвращает изначальный список товаров.
   Метод post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает адрес сервера, обект с данными(order) и метод взаимодействия с сервером(POST), метод возволяет фоормить заказ путем отправки на Сервер данных о заказе.
   Метод handleResponse(response: Response): Promise<object> - проверяет статус ответа и возвращает Promise с объектом данных: при успешном ответе возвращает полученные с срвера данные, преобразуя их в формат json; при ошибке работе с сервером, возвращает сообщение об ошибке.

1. Класс EventEmitter позволяет компонентам подписываться на события, уведомлять других  
   подписчиков о произошедших событиях и инициировать изменения. Класс имеет поле:
   \_events: Map<EventName, Set<Subscriber>> - объект со списком событий и обработчиками, который создается конструктором класса.

   Класс включает в себя методы:
   on<T extends object>(eventName: EventName, callback: (event: T) => void) - принимает событие и функцию обработчик, устанавливает обработчик для этого события;
   off(eventName: EventName, callback: Subscriber) - принимает событие и обработчик, в результате снимает обработчки с этого события, при отсутствии обработчкиво удаляет событие полностью;
   emit<T extends object>(eventName: string, data?: T) - принимает событие и данные, инициирует событие с принятыми данными;
   onAll(callback: (event: EmitterEvent) => void) - принимает обработчки событий как аргумент, устанавливает его для всех компонентов для слушания всех событий;
   offAll() - сбрасывает все обработчкик;
   trigger<T extends object>(eventName: string, context?: Partial<T>) - принимает событие и данные, слушает коллбэк триггер, который генерирует событие при своем вызове.

## Компоненты модели данных (Model)

1. В части Модели данных представлен абстрактный класс Model. Он принимает в конструктор constructor(data: Partial<T>, protected events: IEvents) определенный тип данных и список событий, которые добавляет в создаваемый объект.
   Имеет метод emitChanges(event: string), который принимает название события и оповещает подписчиков об изменнеиях модели.

2. Класс AppState реализует класс Model и сожержит в себе данные проекта, а именно поля:
   catalog: IItem[] - изначальный каталог товаров, полученный с сервера;
   basket: ItemID[] - список id товаров, добавленных в корзину;
   order: IOrder - полные данные о заказе типа IOrder;
   loading: boolean - статус процесса загрузки данных;
   formErrors: FormErrors = {} - список ошибок, возникших при работе с сервером;
   preview: string | null - статус попапа.

Мутоды AppState:
setCatalog(items: IItem[]): void - получает список изначальных карточек от сервера и сохраняет их в каталог в виде реализации интерфейса IItem;
toggleBasketItem(id: ItemID, isAdded: boolean): void - получает id товара и статус его добавленности в корзину, позволяет добавлять или удалять товар из корзины, в зависимости от статуса;
clearBasket(): void - очищает корзину от всех товаров;
getBasketList(): ItemID[] - возвращает полный список id товаров, добавленных в корзину;
setOrderField(field: keyof IOrder, value: string): void - принимает название поля и текст, затем устанавливает текст в соответствующее поле информации о заказе в формате интерфейса IOrder;
validateOrder(): boolean - возвращает boolean в зависимости от того, прошли ли поля ввода валидацию;
getTotal(): number - возвращает полную стоимость товаров, добавленных в корзину.

## Компоненты представления (View)

1. Область компонентов представлена абстрактным классом Component<T>, который принимает в контруктор контейнер типа HTMLElement. Класс определяет базовые методы для всех визуальных компонентов приложения.
   Класс имеет следующие методы:
   toggleClass(element: HTMLElement, className: string) - принимает элемент и имя класса, позволяет добавлять или удалять класс у элемента, в зависимости от того, есть этот уласс у элемента уже или нет;
   setText(element: HTMLElement, value: unknown) - принимает элемент и данные неизвестного типа, позволяет вставить эти данные внутрь элемента как текст или дочерний элемент(ы);
   setDisabled(element: HTMLElement, state: boolean) - принимает элемент и статут активации, далет элемент неактивным или наоборот активным в зависимости от статуса путем добавления или удаления атрибута disabled;
   setHidden(element: HTMLElement) - принимает элемент, делает элемент скрытым путем добавления в стиль элемента атрибута disolay: "none";
   setVisible(element: HTMLElement) - принимает элемент и делает элемент видимым путем удаления из стилей атрибута display;
   setImage(element: HTMLImageElement, src: string, alt?: string) - принимает элемент, ссылку на адрес, тест с описанием (опционально), позволяет устанавливать изобюражение в элемент;
   render(data?: Partial<T>): HTMLElement - принимает опционально данные определенного типа, возвращает корневой DOM элемент.

2. Класс Page наследует от класса Component и представляет собой визуальную реализацию главной страницы приложения. Имеет следующие поля:
   \_logo: HTMLElement - логотипа сайта;
   \_catalog: HTMLElement - каталог товаров;
   \_basket: HTMLElement - кнопка для перехода в корзину;
   \_wrapper: HTMLElement - обертка главной страницы;
   locked: boolean - статус блокировки экрана от прокрутки (при открытии модальных окон).

Конструктор класса constructor(container: HTMLElement, protected events: IEvents) принимает элемент контейнера и список событий, определяет и назначает HTMLElement для полей logo, catalog, basket, wrapper, а также добавляет слушателя событий на кнопку корзины и каталог с товарами.

Класс имеет методы:
set catalog(items: HTMLElement[]) - принимает список элементов товаров и добавляет их в каталог;
set locked(value: boolean) - принимает boolean и регулирует блокировку экрана от прокрутки;
set logo(url: string, alt?: string) - принимает адрес картинки и альтернативный текст при наличии, устанавливает адрес кратинки и альтернативнй текст в элемент.

3. Класс ItemCard наследует от класса Component и представляет себя визуальную реализацию индивидульной карточки товара. Имеет следующие поля:
   id: string - уникальный айди товара;
   title: HTMLElement - название товара;
   price: HTMLElement - цена товара;
   description?: HTMLElement - описание товара (опционально);
   image?: HTMLImageElement - картинка товара (опционально);
   category?: HTMLElement - категория товара (опционально);
   counter?: HTMLElement - счетчик позиции товара в списке (опционально);
   isAdded: boolean - статус товара - добавлен в корзину или нет;
   button?: HTMLButtonElement - кнопка взаимодействия с товаром (опционально);

Конструктор класса constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions) - принимает аргументами название блока для создания единого стиля названия дочерних элементов, контейнер, в котором создается карточка, а также список действий, доступных с элементов. Контруктор осуществляет создание всех дочерних HTML элементов класса (title, price, description, image, category, counter, button), а также вешает обработчики событий на кнопку или всю карточку товара.

Класс имеет методы:
set id(value: string) - принимает id товара и добавляет его как атрибут элемента;
set title(value: string) - принимает текст названия товара и устанавливает в заголовок товара;
set price(value: number) - принимает цену товара, ддобавляет к цене текст и вставляет в элемент с ценой товара;
set description(value: string) - принимает текст описания товара и всталяет в элемент с описанием товара;
set image(value: string) - принимает адрес картинки товара и вставляет ее и описание картинки в элемент картинки товара;
set category(value: string) - принимает текст категории товара и всталяет его в элемент с категорией товара;
set counter() - определяет порядковый номер элемента в списке элементов (в Корзине) и вставляет его в элемент с порядковым номером.
set button(title?: string, image?: string, callback: Function) - принимает название кнопки (опционально), адрес картинки (опционально) и колбэк функцию, вставляет название кнопки или картику в элемент кнопки и навешивает функцию;
toggleIsAdded() - изменяет состяние товара между добавленным в корзину или нет;
get id(): string - возвращает id товара.

a. Класс ItemCardCatalog наследует от класса ItemCard и является визуальным представлением карточки товара в каталоге на главной странице. В данном классе конструктор визуально реализует родительские поля title, price, image, category.

b. Класс ItemCardPreview наследует от класса ItemCard и является визуальным представлением карточки товара в модальном окне просмотра товара. В данном классе конструктор визуально реализует родительские поля title, price, image, category, description, button.

c. Класс ItemCardBasket наследует от класса ItemCard и является визуальным представлением карточки товара в списке товаров в Корзине. В данном классе конструктор визуально реализует родительские поля counter, title, price, button.

4. Класс Form<T> наследует от класса Component и является визуальным представлением формы для ввода информации пользователя о заказе. Класс имеет поля:
   valid: boolean - хранит boolean о прохождении валидации заполнения формы;
   \_submit: HTMLButtonElement - кнопка отправки введенных данных;
   \_errors: HTMLElement - элемент для отображения ошибок заполнения формы.

Конструктор класса constructor(protected container: HTMLFormElement, protected events: IEvents) - принимает аргументами элемент контейнер и список событий, создает HTML элементы кнопки и вывода сообщения об ошибках, а также навешивает слушателей событий на поля ввода и на кнопку отправки данных.

Класс имеет методы:
onInputChange(field: keyof T, value: string) - принимает поле и строчные данные, обновляет данные поля ввода в соответствии с введенными пользователем;
set valid(value: boolean) - принимает статус валидации и активирует (если валидация подтверждена) или деактивирует (если валидация не подтверждена) возможность отправки данных кнопкой submit;
set errors(value: string) - принимает текст ошибки и устанавливает его в элемент показа ошибки заполнения формы;
render(state: Partial<T> & IFormState) - принимает объект с состоянием и возвращает готовый элемент формы с добавлением инпутов.

a. Класс Order наследует от класса Form и визуально реализует элемент заполнения формы заказа с указанием способа оплаты и адреса доставки. Имеет поля:
\_payment: HTMLButtonElement[] - две кнопки для переключения между двумя способами оплаты "Онлайн" или "При получении";
\_address: HTMLInputElement - поле для ввода адреса доставки.

Конструктор класса constructor(container: HTMLFormElement, events: IEvents) принимает контейнер и события и создает форму через родительский конструктор и добавляет туда соответствующие поля ввода.

Класс имеет методы:
set payment(value: string) - получает строку способа оплаты и созраняет данные в объект заказа order в AppState;
set address(value: string) - получает строку адреса и сохраняет адрес в объект данных о заказе order в AppState.

b. Класс Contacts наследует от класса Form и визуально реализует элемент заполнения контактных данных пользователя. Имеет поля:
\_email: HTMLInputElement - поле для ввода адреса почты;
\_phone: HTMLInputElement - поле для ввода номера телефона.

Конструктор класса constructor(container: HTMLFormElement, events: IEvents) принимает контейнер и события и создает форму через родительский конструктор и добавляет туда соответствующие поля ввода.

Класс имеет методы:
set email(value: string) - получает строку адреса почты и сохраняет в объект данных о заказе order в AppState
set phone(value: string) получает строку с номером телефона и сохраняет его в объект данных о заказе order в AppState

## Основные типы данных

```
type ItemID = string;
type Payment = "Онлайн" | "При получении";
type Category = "другое" | "софт-скилл" | "дополнительное" | "кнопка" | "хард-скилл";
type Picture = {
url: string;
title?: string;
alt: string;
}
type Button = {
title?: string;
event: Event;
callback: Function;
disabled?: Boolean;
};
type InputPayment = {
buttonPayOnline: Button;
buttonPayOffline: Button;
}
```
